<!DOCTYPE html>
<html>
<head>
    <!-- <script src="http://code.jquery.com/jquery-1.9"></script> -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" href="ui_page.css">
    <title>Our page</title>
</head>
<body>

    <h1 class="top">Welcome to our page</h1>
    <p id = "stats1"> </p>
    <p id = 'stats2'> </p>
    <p id = 'stats3'> </p>
    <p id = 'stats4'> </p>

    <!-- Table with interactive options -->
    <table>
        <!-- Headers -->
        <thead>
            <tr>
                <!-- Light Interactions -->
                <th>
                    Select Light                    
                </th>
                <!-- Temperature Interactions -->
                <th>
                    Select Tempetature Type
                </th>
                <!-- Display on Arduino -->
                <th>
                    Select Words to Display on Arduino 
                </th>
                 <!-- Standby mode -->
                 <th>
                    Other 
                </th>
            </tr>
        </thead>
        <!-- Body for selction options -->
        <tbody>
            <tr>
                <td>
                     <!-- color -->
                    <form method="post"> 
                        <input type="radio" name="red"> Red <br>
                        <input type="radio" name="blue"> Blue <br>
                        <input type="radio" name="green"> Green <br>
                        <input type="submit" name="submit">
                    </form>
                </td>
                 <td>
                    <!-- temp format -->
                    <form method="post">
                        <input type="radio" id="c" name="c"> Celsius <br>
                        <input type="radio" id="f" name="f"> Fahrenheit <br>
                        <input type="submit" name="submit">
                    </form>
                </td>
                  <td>
                    <!-- letter to dispplay -->
                    <form method="post">
                        <input type="radio" name="l"> LOL <br>
                        <input type="radio" name="s"> SOS <br>
                        <input type="submit" name="submit">
                    </form>
                </td>
                  <td>
                    <!-- sleep mode -->
                    <form method="post">
                        <input type="radio" id="q" name="stdby"> Standby Mode <br>
                        <input type="radio" id="w" name="wake"> Awaken <br>
                        <input type="submit" name="submit"> 
                    </form>
                </td>
            </tr>
        </tbody>
        <tfoot>
            <tr>
            </tr>
        </tfoot>
    </table>

        <!-- BEGIN JAVASCRIPT PART -->
        <script>


            $(document).ready(function() {

                $()




                //TODO TEST THIS 
                var readings = {}; // dictionary to save temperatures

                function update_data() {

                    // get json file data, and add it to a dictionary
                    $.getJSON("output.json", function(data) {
                        var total_temp = 0;
                        var size = 0;
                        var min = Math.max();
                        var max = Math.min();

                        $.each(data, function(key, val) {
                            if (!(key in readings)) {
                                readings[key] = val;
                            }
                        })

                        for (var time in readings) {
                            console.log("total temp: " + total_temp);
                            console.log(size);                    
                            if (withinHour(time)) {
                                if (!isNaN(parseFloat(readings[time]))) {
                                    var temp = parseFloat(readings[time]);
                                    total_temp += temp;
                                    size += 1;
                                    if (temp < min) {
                                        min = temp;
                                    }
                                    if (temp > max) {
                                        max = temp;
                                    }
                                }
                            }
                        }

                        console.log(total_temp);
                        console.log(size);

                        avg = total_temp / size;
                        console.log(avg);
                    });
                }

                update_data();
                var interval = setInterval(update_data, 3000);
            });

            function withinHour(time) {

                // 15:32:56
                console.log(time);
                console.log(typeof time);

                var now = new Date();
                console.log(now.getHours())
                console.log(now.getMinutes())
                console.log(now.getSeconds())

                var hour, min, sec;

                var split = time.split(":");

                if (now.getHours() <= split[0]) {
                    console.log(now.getHours() + " vs " + split[0]);
                    return true;
                } else if (now.getMinutes() <= split[1]) {
                    console.log(now.getMinutes() + " vs " + split[1]);
                    return true;
                } else {
                    console.log("nothing");
                    return false;
                }
            }

            //showing teperature by default 
            $("#stats1").text("The current temperature is " + arr[0] + " Celsius");
            $("#stats2").text("The maximum temperature in the past hour is " + max + " Celsius" );
            $("#stats3").text("The minimum temperature in the past hour is " + min + " Celsius" );
            $("#stats4").text("The average temperature in the past hour is " + avg + " Celsius" );



           $('input:radio[name="c"]').change(function(){
                //display the max, min and average temperature in Celsius 
                console.log("C passed"); //test 
                $("#stats1").text("The current temperature is " + arr[0] + " Celsius");
                $("#stats2").text("The maximum temperature in the past hour is " + max + " Celsius" );
                $("#stats3").text("The minimum temperature in the past hour is " + min + " Celsius" );
                $("#stats4").text("The average temperature in the past hour is " + avg + " Celsius" );
            });;

            $('input:radio[name="f"]').change(function(){
                //display the max, min and average temperature in Ferinheight  
                console.log("F passed"); //test 
                $("#stats1").text("The current temperature is " + ((arr[0])*9/5+32) + " Ferinheight");
                $("#stats2").text("The maximum temperature in the past hour is " + (max*9/5+32) + " Ferinheight");
                $("#stats3").text("The minimum temperature in the past hour is " + (min*9/5+32) + " Ferinheight");
                $("#stats4").text("The average temperature in the past hour is " + (avg*9/5+32) + " Ferinheight");
            });

            $('input:radio[name="stdby"]').change(function(){
                //display the max, min and average temperature in Ferinheight  
                console.log("sleep mode "); //test 
                $("#stats1").text(''); 
                $("#stats2").text(''); 
                $("#stats3").text(''); 
                $("#stats4").text(''); 
            });
              $('input:radio[name="wake"]').change(function(){
                //display the max, min and average temperature in Celsius 
                console.log("C passed"); //test 
                $("#stats1").text("The current temperature is " + arr[0] + " Celsius");
                $("#stats2").text("The maximum temperature in the past hour is " + max + " Celsius" );
                $("#stats3").text("The minimum temperature in the past hour is " + min + " Celsius" );
                $("#stats4").text("The average temperature in the past hour is " + avg + " Celsius" );
            });
        </script>        
    </p>

    

</body>
</html>